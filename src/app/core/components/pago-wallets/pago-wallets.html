<!--  SECCIN 1: Autenticaci贸n y selecci贸n de blockchain/wallet -->
<div class="auth-section">
  <div *ngIf="isAuthenticated">
    <p>Autenticado como: {{ firebaseUser?.email || 'Usuario an贸nimo' }} 
      <span *ngIf="isAdmin"> Admin</span>
    </p>
    <p>UID: {{ firebaseUser?.uid }}</p>
    <button (click)="logout()"> Cerrar sesi贸n</button>
    <div *ngIf="isAdmin">
      <p>Funciones de administrador:</p>
      <button (click)="resetAdminTo()"> Resetear Direcci贸n Admin</button>
    </div>
  </div>
  <div *ngIf="!isAuthenticated">
    <p>No autenticado - Elige c贸mo quieres continuar:</p>
    <button (click)="authWallet.signInWithGoogle()"> Iniciar con Google</button>
    <button (click)="loginAnonymous()"> Pagar an贸nimamente</button>
    <p>* Google te permite guardar tu historial de transacciones</p>
  </div>
</div>

<div class="blockchain-selector">
  <h3>Seleccionar Blockchain</h3>
  <button (click)="selectBlockchain('ethereum')">Ethereum</button>
  <button (click)="selectBlockchain('solana')">Conectar Wallet Solana</button>
  <p>Modo actual: {{ currentBlockchain() === 'ethereum' ? 'Ethereum' : 'Solana' }}</p>
</div>

<div *ngIf="showSolanaSelector" class="wallet-selector">
  <h3>Seleccionar Wallet Solana</h3>
  <p>Elige c贸mo quieres conectarte:</p>
  <div class="wallet-options">
    <button *ngFor="let wallet of solanaWallets" (click)="selectSolanaWallet(wallet.name)">
      {{ wallet.icon }} {{ wallet.name }}
    </button>
  </div>
  <button (click)="cancelWalletSelection()">Cancelar</button>
</div>

<div class="status">
  <p>Estado: {{ currentBlockchain() === 'ethereum' ? providerStatus : solanaProviderStatus }}</p>
  <button (click)="debugService()">Debug</button>
</div>

<div class="no-wallet" *ngIf="!account && currentBlockchain() === 'ethereum'">
  <p>No hay wallet Ethereum conectada.</p>
  <button (click)="connectWallet()"> Conectar MetaMask</button>
</div>

<div *ngIf="!solanaConnected && currentBlockchain() === 'solana'">
  <p>Selecciona "Conectar Wallet Solana" arriba para comenzar</p>
  <p>Wallets detectadas: {{ solanaWallets.length }}</p>
  <p *ngIf="solanaWallets.length === 0">
    No se detectaron wallets Solana. Instala Phantom o Solflare.
  </p>
</div>

<!--  SECCIN 2: Informaci贸n de wallet + Token + Chains + Env铆os -->
<div *ngIf="account && currentBlockchain() === 'ethereum'" class="wallet-ethereum">
  <h3>Ethereum Wallet</h3>
  <p>Cuenta: {{ account }}</p>
 <p>
  <span class="red-actual" [ngClass]="getNetworkClassFromName(chainName())">RED ACTUAL:</span> 
  <span class="network-badge" [ngClass]="getNetworkClassFromName(chainName())">
    {{ chainName() }} (ID: {{ chainId }} - {{ chainSymbol }})
  </span>
</p>

  <div *ngIf="currentToken()">
    <p>Token: {{ currentToken()?.symbol }} - Saldo: {{ getCurrentTokenBalance() }}</p>
  </div>

  <div class="chain-switch">
    <h4>Cambiar Red</h4>
    <select (change)="switchChain($any($event.target).value)">
      <option *ngFor="let chain of availableChains" [value]="chain.id">{{ chain.name }}</option>
    </select>
  </div>

  <!-- Token Selector -->
  <div class="token-selector" *ngIf="availableTokens().length > 0">
    <h4>Seleccionar Token</h4>
    <select [ngModel]="currentToken()" (ngModelChange)="onTokenChange($event)" class="token-dropdown">
      <option *ngFor="let token of availableTokens()" [ngValue]="token">
        {{ token.symbol }} - {{ token.name }}
        <span *ngIf="tokenBalances().get(token.address)">
          ({{ tokenBalances().get(token.address) }})
        </span>
      </option>
    </select>
  </div>

  <!-- Env铆os -->
  <div>
    <h4>Enviar</h4>
    <div *ngIf="!isHardcoded()">
      <p>No hay direcci贸n administrativa configurada.</p>
    </div>
    <input type="text" [ngModel]="adminTo() ?? ''" [disabled]="isHardcoded()" placeholder="Direcci贸n de destino">
    <input type="text" [(ngModel)]="amount" placeholder="Monto (ej: 0.0008)"
           (keypress)="validateNumericInput($event)">
    <button [disabled]="!isAuthenticated || !isHardcoded() || getCurrentTokenBalanceNumber() <= 0"
            (click)="sendTransaction(to, amount)">
      {{ !isAuthenticated ? ' Autent铆cate primero' : !isHardcoded() ? ' Configura direcci贸n admin' : ' Enviar' }}
    </button>
  </div>
</div>

<div *ngIf="solanaConnected && currentBlockchain() === 'solana'" class="wallet-solana">
  <h3>Solana Wallet Conectada</h3>
  <p>Wallet: {{ solanaWalletName }}</p>
  <p>Cuenta: {{ solanaAccount }}</p>
  <p>Saldo: {{ solanaBalance }} SOL</p>

  <div *ngIf="currentToken()">
    <p>Token: {{ currentToken()?.symbol }} - Saldo: {{ getCurrentTokenBalance() }}</p>
  </div>

  <!-- Token Selector -->
  <div class="token-selector" *ngIf="availableTokens().length > 0">
    <h4>Seleccionar Token</h4>
    <select [ngModel]="currentToken()" (ngModelChange)="onTokenChange($event)" class="token-dropdown">
      <option *ngFor="let token of availableTokens()" [ngValue]="token">
        {{ token.symbol }} - {{ token.name }}
        <span *ngIf="tokenBalances().get(token.address)">
          ({{ tokenBalances().get(token.address) }})
        </span>
      </option>
    </select>
  </div>

  <!-- Env铆os -->
  <div>
    <h4>Enviar</h4>
    <div *ngIf="!isHardcoded()">
      <p>No hay direcci贸n administrativa configurada.</p>
    </div>
    <input type="text" [ngModel]="adminTo() ?? ''" [disabled]="isHardcoded()" placeholder="Direcci贸n de destino">
    <input type="text" [(ngModel)]="amount" placeholder="Monto (ej: 0.0008)"
           (keypress)="validateNumericInput($event)">
    <button [disabled]="!solanaConnected || !isHardcoded() || getCurrentTokenBalanceNumber() <= 0"
            (click)="sendTransaction(to, amount)">
      {{ !solanaConnected ? ' Conecta wallet primero' : !isHardcoded() ? ' Configura direcci贸n admin' : ' Enviar' }}
    </button>
  </div>
</div>

<!--  SECCIN 3: Transacciones al final -->
<div class="transactions-ethereum">
  <h3>Transacciones Ethereum</h3>
  <table *ngIf="ethTransactions().length > 0">
    <tr>
      <th>Tx Hash</th>
      <th>De</th>
      <th>A</th>
      <th>Monto</th>
      <th>Moneda</th>
      <th>Fecha</th>
      <th>Estado</th>
    </tr>
    <tr *ngFor="let tx of ethTransactions()">
      <td><a [href]="getExplorerUrl(tx)" target="_blank">{{ tx.txHash | slice:0:10 }}...</a></td>
      <td>{{ tx.from | slice:0:10 }}...</td>
      <td>{{ tx.to | slice:0:10 }}...</td>
      <td>{{ tx.amount }}</td>
      <td>{{ tx.currency }}</td>
      <td>{{ formatTimestamp(tx.timestamp) | date:'short' }}</td>
      <td>{{ tx.status }}</td>
    </tr>
  </table>
  <p *ngIf="ethTransactions().length === 0">No hay transacciones Ethereum.</p>
</div>

<div class="transactions-solana">
  <h3>Transacciones Solana</h3>
  <table *ngIf="solanaTransactions().length > 0">
    <tr>
      <th>Tx Hash</th>
      <th>De</th>
      <th>A</th>
      <th>Monto</th>
      <th>Moneda</th>
      <th>Fecha</th>
      <th>Estado</th>
    </tr>
    <tr *ngFor="let tx of solanaTransactions()">
      <td><a [href]="getExplorerUrl(tx)" target="_blank">{{ tx.txHash | slice:0:10 }}...</a></td>
      <td>{{ tx.from | slice:0:10 }}...</td>
      <td>{{ tx.to | slice:0:10 }}...</td>
      <td>{{ tx.amount }}</td>
      <td>{{ tx.currency }}</td>
      <td>{{ formatTimestamp(tx.timestamp) | date:'short' }}</td>
      <td>{{ tx.status }}</td>
    </tr>
  </table>
  <p *ngIf="solanaTransactions().length === 0">No hay transacciones Solana.</p>
</div>
