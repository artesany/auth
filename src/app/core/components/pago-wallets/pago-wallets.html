<div>
  <!-- Modal para selección de wallet Solana -->
  <div *ngIf="showSolanaSelector">
    <div>
      <h3>Seleccionar Wallet Solana</h3>
      <p>Elige cómo quieres conectarte:</p>
      
      <div>
        <button 
          *ngFor="let wallet of solanaWallets"
          (click)="selectSolanaWallet(wallet.name)"
        >
          {{ wallet.icon }} {{ wallet.name }}
        </button>
      </div>

      <button (click)="cancelWalletSelection()">
        Cancelar
      </button>
    </div>
  </div>

  <!-- Selector de Blockchain -->
  <div>
    <h3>Seleccionar Blockchain</h3>
    <div>
      <button (click)="selectBlockchain('ethereum')">
        Ethereum
      </button>
      <button (click)="selectBlockchain('solana')">
        Conectar Wallet Solana
      </button>
    </div>
    <p>
      Modo: <strong>{{ currentBlockchain() === 'ethereum' ? 'Ethereum' : 'Solana' }}</strong>
    </p>
  </div>

  <!-- Debug Info -->
  <div>
    <p>
      <strong>Estado:</strong> 
      {{ currentBlockchain() === 'ethereum' ? providerStatus : solanaProviderStatus }}
    </p>
    <button (click)="debugService()">
      Debug
    </button>
  </div>

  <!-- Sección de Ethereum -->
  <div *ngIf="currentBlockchain() === 'ethereum'">
    <!-- Estado de Autenticación -->
    <div>
      <p *ngIf="isAuthenticated; else notAuthenticated">
        Autenticado: {{ firebaseUser?.email || 'Usuario anónimo' }}
        <button (click)="logout()">
          Cerrar sesión
        </button>
      </p>
      <ng-template #notAuthenticated>
        <p>No autenticado</p>
        <button (click)="loginAnonymous()">
          Pagar anomimamente
        </button>
      </ng-template>
    </div>

    <!-- Wallet info Ethereum -->
    <div *ngIf="account; else connectWalletTemplate">
      <h3>Ethereum Wallet</h3>
      <p>Cuenta: {{ account }}</p>
      <p>Red: {{ chainSymbol }} (ID: {{ chainId }})</p>
      <p>Saldo: {{ balance }} {{ chainSymbol }}</p>

      <!-- Selector de Red -->
      <div>
        <h4>Cambiar Red</h4>
        <div>
          <button 
            *ngFor="let chain of availableChains" 
            (click)="switchChain(chain.id)"
          >
            {{ chain.name }}
          </button>
        </div>
      </div>

      <!-- Enviar transacción Ethereum -->
      <div>
        <h4>Enviar ETH</h4>
        <input 
          [(ngModel)]="to" 
          placeholder="Dirección destino (0x...)" 
        />
        <input 
          [(ngModel)]="amount" 
          placeholder="Cantidad {{ chainSymbol }}" 
        />
        <button 
          (click)="sendTransaction(to, amount)" 
          [disabled]="!isAuthenticated || !to || !amount"
        >
          {{ !isAuthenticated ? 'Autentícate primero' : 'Enviar ETH' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Sección de Solana -->
  <div *ngIf="currentBlockchain() === 'solana'">
    <!-- Wallet info Solana -->
    <div *ngIf="solanaConnected; else connectSolanaTemplate">
      <h3>Solana Wallet Conectada</h3>
      <p>Wallet: {{ solanaWalletName }}</p>
      <p>Cuenta: {{ solanaAccount }}</p>
      <p>Saldo: {{ solanaBalance }} SOL</p>

      <!-- Enviar transacción Solana -->
      <div>
        <h4>Enviar SOL</h4>
        <input 
          [(ngModel)]="to" 
          placeholder="Dirección destino (Solana address)" 
        />
        <input 
          [(ngModel)]="amount" 
          placeholder="Cantidad SOL" 
        />
        <button 
          (click)="sendTransaction(to, amount)" 
          [disabled]="!solanaConnected || !to || !amount"
        >
          Enviar SOL
        </button>
      </div>
    </div>

    <!-- Template específico para conectar Solana -->
    <ng-template #connectSolanaTemplate>
      <div>
        <p>Selecciona "Conectar Wallet Solana" arriba para comenzar</p>
        <div *ngIf="solanaWallets.length > 0">
          <p>Wallets detectadas: {{ solanaWallets.length }}</p>
        </div>
        <div *ngIf="solanaWallets.length === 0">
          <p>No se detectaron wallets Solana. Instala Phantom o Solflare.</p>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- Template cuando no hay wallet Ethereum conectada -->
  <ng-template #connectWalletTemplate>
    <div>
      <p>No hay wallet Ethereum conectada.</p>
      <button (click)="connectWallet()">
        Conectar MetaMask
      </button>
    </div>
  </ng-template>
</div>